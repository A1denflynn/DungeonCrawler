<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Backpack</title>
<link rel="stylesheet" href="style.css">
<style>
  body { font-family: sans-serif; margin: 20px; }
  #backpack { margin-top: 20px; }
  .item { margin-bottom: 8px; }
  button { margin-left: 10px; }
</style>
</head>
<body>
<h1>Backpack</h1>
<div id="backpack"></div>
<button onclick="goBack()">Back to Dungeon</button>

<script>
let dungeonState;

// Load current player state
function loadBackpack() {
    fetch('/api/getState') // returns DungeonState
        .then(res => res.json())
        .then(data => {
            dungeonState = data;
            renderBackpack();
        });
}

// Render backpack items
function renderBackpack() {
    const container = document.getElementById('backpack');
    container.innerHTML = '';

    const backpack = dungeonState.player.backpack;
    if(!backpack || backpack.length === 0){
        container.innerHTML = "<p>Backpack is empty</p>";
        return;
    }

    backpack.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'item';
        div.textContent = `${item.name} x${item.quantity || 1}`;

        // Allow using potions
        if(['health potion','atk potion','luck potion'].includes(item.name.toLowerCase())){
            const btn = document.createElement('button');
            btn.textContent = "Use";
            btn.onclick = () => useItem(index);
            div.appendChild(btn);
        }

        container.appendChild(div);
    });
}

// Use an item
function useItem(index) {
    fetch(`/api/useItem?index=${index}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            dungeonState = data;
            renderBackpack(); // refresh inventory
            alert(dungeonState.player.lastPickedUpItem);
        });
}

// Go back to dungeon
function goBack() {
    window.location.href = 'index.html';
}

loadBackpack();
</script>
</body>
</html>
